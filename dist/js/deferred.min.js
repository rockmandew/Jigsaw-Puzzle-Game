!function(e){function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(e,t){if(n(e))for(var r=0;r<e.length;r++)t(e[r]);else t(e)}function r(e){var i="pending",o=[],f=[],l=[],u=null,s={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"resolved"===i&&t[r].apply(this,u),o.push(t[r]);else"resolved"===i&&arguments[e].apply(this,u),o.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"rejected"===i&&t[r].apply(this,u),f.push(t[r]);else"rejected"===i&&arguments[e].apply(this,u),f.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(n(arguments[e]))for(var t=arguments[e],r=0;r<t.length;r++)"pending"===i&&l.push(t[r]);else"pending"===i&&l.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return s;for(var n in s)e[n]=s[n];return e},state:function(){return i},debug:function(){console.log("[debug]",o,f,i)},isRejected:function(){return"rejected"===i},isResolved:function(){return"resolved"===i},pipe:function(e,n,i){return r((function(r){t(e,(function(e){"function"==typeof e?h.done((function(){var n=e.apply(this,arguments);n&&"function"==typeof n?n.promise().then(r.resolve,r.reject,r.notify):r.resolve(n)})):h.done(r.resolve)})),t(n,(function(e){"function"==typeof e?h.fail((function(){var n=e.apply(this,arguments);n&&"function"==typeof n?n.promise().then(r.resolve,r.reject,r.notify):r.reject(n)})):h.fail(r.reject)}))})).promise()}},h={resolveWith:function(e){if("pending"===i){i="resolved";for(var n=u=arguments.length>1?arguments[1]:[],t=0;t<o.length;t++)o[t].apply(e,n)}return this},rejectWith:function(e){if("pending"===i){i="rejected";for(var n=u=arguments.length>1?arguments[1]:[],t=0;t<f.length;t++)f[t].apply(e,n)}return this},notifyWith:function(e){if("pending"===i)for(var n=u=arguments.length>1?arguments[1]:[],t=0;t<l.length;t++)l[t].apply(e,n);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},p=s.promise(h);return e&&e.apply(p,[p]),p}r.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():r().resolve(e).promise()}return function(e){for(var n=r(),t=e.length,i=0,o=new Array(t),f=0;f<e.length;f++)!function(r){var f=null;e[r].done?e[r].done((function(){o[r]=arguments.length<2?arguments[0]:arguments,++i==t&&n.resolve.apply(n,o)})).fail((function(){n.reject(arguments)})):(f=e[r],e[r]=new Deferred,e[r].done((function(){o[r]=arguments.length<2?arguments[0]:arguments,++i==t&&n.resolve.apply(n,o)})).fail((function(){n.reject(arguments)})).resolve(f))}(f);return n.promise()}(arguments)},e.Deferred=r}(window);